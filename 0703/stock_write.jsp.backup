<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
<%@ page contentType="text/html; charset=utf-8"%>
<%@ page import="java.sql.*,javax.sql.*,java.io.*" %>
<%@page import="java.io.File"%>
<%@page import="com.oreilly.servlet.multipart.DefaultFileRenamePolicy"%>
<%@page import="com.oreilly.servlet.MultipartRequest"%>
<%
	String key = request.getParameter("key");
	String u_id = request.getParameter("id");
	String u_inven = request.getParameter("inven");
%>
<html>
<head>
</head>
<body>
<%
	Class.forName("com.mysql.jdbc.Driver");
	Connection conn = DriverManager.getConnection("jdbc:mysql://localhost/kopo03", "root", "kopo03");
	Statement stmt = conn.createStatement();
	
	if(key == null) key = "";
	
	if(key.equals("UPDATE")){
		stmt.execute("update stock set inven="+u_inven+", take_inven=now() where id="+u_id);
	} else {
	
	String saveDir = application.getRealPath("/0701/img/");
	int maxSize = 1024*1024*100;
	String encType = "UTF-8";

	MultipartRequest multipartRequest
	= new MultipartRequest(request, saveDir, maxSize, encType, new DefaultFileRenamePolicy());
	
	String id = multipartRequest.getParameter("id");
	String product = multipartRequest.getParameter("product");
	String inven = multipartRequest.getParameter("inven");
	String detail = multipartRequest.getParameter("detail");

//	String product2=new String(product.getBytes("8859_1"),"utf-8");
//	String detail2=new String(detail.getBytes("8859_1"),"utf-8");
	
//  out.write("이름 : " + multipartRequest.getParameter("name") + "<br>");
//  out.write("파일 : " + multipartRequest.getParameter("file") + "<br>"); //null 값을 갖는다.
//  out.write("업로드파일명 : " + multipartRequest.getFilesystemName("file") + "<br>");
//  out.write("원래파일명 : " + multipartRequest.getOriginalFileName("file") + "<br>");
    
//  File file = multipartRequest.getFile("file");
	

	stmt.execute("insert into stock (id, product, inven, take_inven, product_regist, detail, photo) values("
			+id+",'"+product+"', "+inven+", now(), now(), '"+detail+"', '/0701/img/"+multipartRequest.getOriginalFileName("file")+"')");
	}
	
	stmt.close();
	conn.close();
%>
<script>location.href = "stock_list.jsp"; </script>
</body>
</html>